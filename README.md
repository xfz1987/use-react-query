# Use react-query

## 为什么不建议使用 useEffect

- 组件卸载荷重新挂载时需要重新获取数据
- 在 useEffect 中直接获取数据可能导致“网络瀑布效应”
- 在 useEffect 中获取数据通常不支持数据预加载或缓存
- useEffect 在服务端没有运行环境，导致服务端渲染的 HTML 没有数据
- 如果每个组件都在 useEffect 中单独获取数据（正常不应该这么做，不符合 SOLID 原则），这可能导致数据获取顺序上的依赖，即一个组件的数据获取依赖于另一个组件的数据获取完成。这种情况下，数据的获取可能会顺序进行，而不是并行，导致整体加载时间加长（业务数据依赖场景除外）

## Why

1. 内置缓存功能：React Query 为获取的数据提供缓存机制，这意味着当组件重新渲染或用户重新访问相同的数据时，不需要再次发起网络请求，
   可以直接从缓存中获取数据，这减少了不必要的网络请求，提高了应用的效率

2. 管理加载和错误状态：在处理异步数据时，管理加载状态和错误状态往往比较繁琐。react-query 提供了抽象化的方式来处理这些状态，简化了开发者的工作

3. 优化数据获取：react-query 会自动合并重复的查询请求，并将他们批量处理，这意味着如果多个组件请求相同的数据，react-query 只会发起一次网络请求，然后将数据分发给所有请求的组件

4. 节省带宽和提供内存性能：通过减少不必要的网络请求和优化数据处理，react-query 可以帮助节省带宽并提高应用的内存性能

5. 数据同步：在复杂的应用中，保持组件间数据的同步是一个挑战，react-query 通过其底层机制，帮助保持不同组件间数据的一致性
